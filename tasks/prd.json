{
  "project": "Medic UI Edit Functionality",
  "branchName": "feature/ui-edit-functionality",
  "description": "Add comprehensive edit functionality to the Medic UI, enabling users to create, edit, and manage services without relying on curl commands or direct API calls. Includes inline editing, bulk operations, and backup/restore functionality.",
  "linearProject": "Medic v2",
  "prdFile": "tasks/prd-ui-edit-functionality.md",
  "gitWorkflow": {
    "baseBranch": "main",
    "pullBeforeStart": true,
    "commitMessageFormat": "feat(${scope}): ${message}\n\n${linearTicket}"
  },
  "requirements": {
    "updateTests": true,
    "updateDocumentation": true,
    "typecheckRequired": true,
    "lintRequired": true,
    "verifyInBrowser": true
  },
  "phases": [
    {
      "name": "Phase 1: Infrastructure",
      "description": "Database schema, API endpoints, and UI component foundation"
    },
    {
      "name": "Phase 2: Inline Editing",
      "description": "Quick inline editing in the Services table"
    },
    {
      "name": "Phase 3: Modal Forms",
      "description": "Full edit and create modals"
    },
    {
      "name": "Phase 4: Bulk Operations",
      "description": "Row selection and bulk actions"
    },
    {
      "name": "Phase 5: History & Restore",
      "description": "Backup/restore functionality"
    }
  ],
  "userStories": [
    {
      "id": "US-001",
      "linearTicket": "SRE-105",
      "linearUrl": "https://linear.app/linq/issue/SRE-105",
      "title": "Add service snapshots database table",
      "description": "As a developer, I need to store service state snapshots so users can restore previous configurations after destructive actions.",
      "phase": 1,
      "type": "backend",
      "scope": "db",
      "dependencies": [],
      "acceptanceCriteria": [
        "Create migration for medic.service_snapshots table with fields: snapshot_id, service_id, snapshot_data (JSONB), action_type, actor, created_at, restored_at",
        "Add index on service_id and created_at",
        "Migration runs successfully on docker-compose",
        "Update docs/ARCHITECTURE.md with new table schema",
        "Typecheck passes"
      ],
      "passes": true
    },
    {
      "id": "US-002",
      "linearTicket": "SRE-106",
      "linearUrl": "https://linear.app/linq/issue/SRE-106",
      "title": "Create snapshot API endpoints",
      "description": "As a developer, I need API endpoints to create and restore snapshots so the UI can offer undo functionality.",
      "phase": 1,
      "type": "backend",
      "scope": "api",
      "dependencies": ["US-001"],
      "acceptanceCriteria": [
        "GET /v2/snapshots - list snapshots with filters (service_id, action_type, date range)",
        "GET /v2/snapshots/:id - get single snapshot details",
        "POST /v2/snapshots/:id/restore - restore service to snapshot state",
        "Auto-create snapshots before destructive actions in existing endpoints",
        "Add unit tests for all new endpoints",
        "Update Swagger/OpenAPI documentation",
        "Typecheck passes"
      ],
      "passes": true
    },
    {
      "id": "US-003",
      "linearTicket": "SRE-107",
      "linearUrl": "https://linear.app/linq/issue/SRE-107",
      "title": "Add Dialog component to UI",
      "description": "As a developer, I need a reusable Dialog/Modal component for edit forms and confirmations.",
      "phase": 1,
      "type": "frontend",
      "scope": "ui",
      "dependencies": [],
      "acceptanceCriteria": [
        "Install shadcn Dialog component via CLI",
        "Component supports controlled open/close state",
        "Includes DialogTrigger, DialogContent, DialogHeader, DialogFooter",
        "Accessible (focus trap, escape to close)",
        "Typecheck passes"
      ],
      "passes": true
    },
    {
      "id": "US-004",
      "linearTicket": "SRE-108",
      "linearUrl": "https://linear.app/linq/issue/SRE-108",
      "title": "Add Toast notification component",
      "description": "As a developer, I need a toast/notification system to show success and error messages after actions.",
      "phase": 1,
      "type": "frontend",
      "scope": "ui",
      "dependencies": [],
      "acceptanceCriteria": [
        "Install shadcn Toast component via CLI",
        "Add Toaster provider to app layout",
        "Supports success, error, warning variants",
        "Toasts auto-dismiss after 5 seconds",
        "Typecheck passes"
      ],
      "passes": true
    },
    {
      "id": "US-005",
      "linearTicket": "SRE-109",
      "linearUrl": "https://linear.app/linq/issue/SRE-109",
      "title": "Create mutation hooks for service CRUD",
      "description": "As a developer, I need React Query mutation hooks for creating, updating, and bulk updating services.",
      "phase": 1,
      "type": "frontend",
      "scope": "ui",
      "dependencies": [],
      "acceptanceCriteria": [
        "Create useUpdateService hook with optimistic updates",
        "Create useCreateService hook",
        "Create useBulkUpdateServices hook",
        "All hooks invalidate queries on success",
        "Add tests for all hooks",
        "Typecheck passes"
      ],
      "passes": true
    },
    {
      "id": "US-006",
      "linearTicket": "SRE-110",
      "linearUrl": "https://linear.app/linq/issue/SRE-110",
      "title": "Add inline toggle switches to Services table",
      "description": "As a user, I want to quickly toggle mute/active status directly from the services table.",
      "phase": 2,
      "type": "frontend",
      "scope": "ui",
      "dependencies": ["US-003", "US-004", "US-005"],
      "acceptanceCriteria": [
        "Add Switch component from shadcn",
        "Mute column shows toggle switch instead of text",
        "Active column shows toggle with confirmation dialog for deactivate",
        "Deactivation creates snapshot before applying",
        "Optimistic UI updates",
        "Toast notifications on success/failure",
        "Add tests for toggle interactions",
        "Verify in browser",
        "Typecheck passes"
      ],
      "passes": true
    },
    {
      "id": "US-007",
      "linearTicket": "SRE-111",
      "linearUrl": "https://linear.app/linq/issue/SRE-111",
      "title": "Add inline priority selector",
      "description": "As a user, I want to quickly change a service's priority from the table.",
      "phase": 2,
      "type": "frontend",
      "scope": "ui",
      "dependencies": ["US-004", "US-005"],
      "acceptanceCriteria": [
        "Priority column shows compact dropdown selector",
        "Color-coded options: P1=red, P2=yellow, P3=gray",
        "Immediate update on selection",
        "Toast notification on success",
        "Add tests",
        "Verify in browser",
        "Typecheck passes"
      ]
    },
    {
      "id": "US-008",
      "linearTicket": "SRE-69",
      "linearUrl": "https://linear.app/linq/issue/SRE-69",
      "title": "Create ServiceEditModal component",
      "description": "As a user, I want to edit all service fields in a modal so I can make comprehensive changes.",
      "phase": 3,
      "type": "frontend",
      "scope": "ui",
      "dependencies": ["US-003", "US-004", "US-005"],
      "acceptanceCriteria": [
        "Modal with form fields: service_name, team, priority, alert_interval, threshold, runbook",
        "Current values pre-populated",
        "Client-side validation with error messages",
        "Save button disabled while invalid or unchanged",
        "Toast on success/failure",
        "Modal closes on successful save",
        "Add tests",
        "Verify in browser",
        "Typecheck passes"
      ]
    },
    {
      "id": "US-009",
      "linearTicket": "SRE-70",
      "linearUrl": "https://linear.app/linq/issue/SRE-70",
      "title": "Create ServiceCreateModal component",
      "description": "As a user, I want to create new services through the UI without using curl.",
      "phase": 3,
      "type": "frontend",
      "scope": "ui",
      "dependencies": ["US-003", "US-004", "US-005"],
      "acceptanceCriteria": [
        "Add Service button in Services page header",
        "Modal with fields: heartbeat_name, service_name, team, priority, alert_interval, threshold, runbook",
        "Sensible defaults: priority=P3, alert_interval=5, threshold=1",
        "Client-side validation",
        "Error toast if heartbeat_name already exists",
        "Add tests",
        "Verify in browser",
        "Typecheck passes"
      ]
    },
    {
      "id": "US-010",
      "linearTicket": "SRE-120",
      "linearUrl": "https://linear.app/linq/issue/SRE-120",
      "title": "Add Edit button to ServiceDetail page",
      "description": "As a user, I want to edit a service from its detail page.",
      "phase": 3,
      "type": "frontend",
      "scope": "ui",
      "dependencies": ["US-008"],
      "acceptanceCriteria": [
        "Edit button in ServiceDetail header next to Back button",
        "Button opens ServiceEditModal with current service data",
        "Page refreshes after successful edit",
        "Add tests",
        "Verify in browser",
        "Typecheck passes"
      ]
    },
    {
      "id": "US-011",
      "linearTicket": "SRE-119",
      "linearUrl": "https://linear.app/linq/issue/SRE-119",
      "title": "Add quick action buttons to ServiceDetail",
      "description": "As a user, I want quick mute/unmute and activate/deactivate buttons on the service detail page.",
      "phase": 3,
      "type": "frontend",
      "scope": "ui",
      "dependencies": ["US-003", "US-004", "US-005"],
      "acceptanceCriteria": [
        "Mute/Unmute button with icon in header",
        "Activate/Deactivate button with confirmation dialog",
        "Actions create snapshots for undo capability",
        "Toast notifications on success/failure",
        "Page refreshes after action",
        "Add tests",
        "Verify in browser",
        "Typecheck passes"
      ]
    },
    {
      "id": "US-012",
      "linearTicket": "SRE-112",
      "linearUrl": "https://linear.app/linq/issue/SRE-112",
      "title": "Add row selection and bulk actions toolbar",
      "description": "As a user, I want to select multiple services and perform bulk actions.",
      "phase": 4,
      "type": "frontend",
      "scope": "ui",
      "dependencies": ["US-003", "US-004", "US-005"],
      "acceptanceCriteria": [
        "Add Checkbox component from shadcn",
        "Checkbox column with select-all in header",
        "Selected count shown in toolbar",
        "Bulk actions: Mute, Unmute, Activate, Deactivate, Change Priority, Change Team",
        "Confirmation dialog for destructive actions with service list",
        "All bulk actions create snapshots",
        "Progress indicator for operations",
        "Summary toast on completion",
        "Selection cleared after action",
        "Add tests",
        "Verify in browser",
        "Typecheck passes"
      ]
    },
    {
      "id": "US-013",
      "linearTicket": "SRE-113",
      "linearUrl": "https://linear.app/linq/issue/SRE-113",
      "title": "Add bulk edit modal for team/priority",
      "description": "As a user, I want to change team or priority for multiple services at once.",
      "phase": 4,
      "type": "frontend",
      "scope": "ui",
      "dependencies": ["US-012"],
      "acceptanceCriteria": [
        "Modal shows list of selected services",
        "Dropdowns for team and priority values",
        "Preview of changes before applying",
        "Creates snapshots before applying",
        "Toast summary on completion",
        "Add tests",
        "Verify in browser",
        "Typecheck passes"
      ]
    },
    {
      "id": "US-014",
      "linearTicket": "SRE-118",
      "linearUrl": "https://linear.app/linq/issue/SRE-118",
      "title": "Add row actions menu to Services table",
      "description": "As a user, I want a context menu on each table row for quick access to actions.",
      "phase": 4,
      "type": "frontend",
      "scope": "ui",
      "dependencies": ["US-008"],
      "acceptanceCriteria": [
        "Add DropdownMenu component from shadcn",
        "Three-dot menu on each row",
        "Menu items: View Details, Edit, Mute/Unmute, Activate/Deactivate, View History",
        "Destructive items styled in red",
        "Keyboard accessible",
        "Add tests",
        "Verify in browser",
        "Typecheck passes"
      ]
    },
    {
      "id": "US-015",
      "linearTicket": "SRE-114",
      "linearUrl": "https://linear.app/linq/issue/SRE-114",
      "title": "Create useSnapshots query and restore hooks",
      "description": "As a developer, I need React Query hooks to fetch and restore service snapshots.",
      "phase": 5,
      "type": "frontend",
      "scope": "ui",
      "dependencies": ["US-002"],
      "acceptanceCriteria": [
        "Add Snapshot types to ui/src/lib/api.ts",
        "Add API client methods for snapshots",
        "Create useSnapshots query hook with filters",
        "Create useRestoreSnapshot mutation hook",
        "Restore invalidates both snapshots and services queries",
        "Add tests",
        "Typecheck passes"
      ]
    },
    {
      "id": "US-016",
      "linearTicket": "SRE-115",
      "linearUrl": "https://linear.app/linq/issue/SRE-115",
      "title": "Add History tab to ServiceDetail page",
      "description": "As a user, I want to see change history for a service and restore previous states.",
      "phase": 5,
      "type": "frontend",
      "scope": "ui",
      "dependencies": ["US-003", "US-015"],
      "acceptanceCriteria": [
        "Add Tabs component from shadcn",
        "Overview and History tabs on ServiceDetail",
        "Snapshot list with action type, actor, timestamp, change summary",
        "Restore button on each snapshot with confirmation dialog",
        "Already-restored snapshots show badge",
        "Empty state message if no history",
        "Add tests",
        "Verify in browser",
        "Typecheck passes"
      ]
    },
    {
      "id": "US-017",
      "linearTicket": "SRE-116",
      "linearUrl": "https://linear.app/linq/issue/SRE-116",
      "title": "Add Service History page",
      "description": "As a user, I want a dedicated page to view and restore service changes across all services.",
      "phase": 5,
      "type": "frontend",
      "scope": "ui",
      "dependencies": ["US-015"],
      "acceptanceCriteria": [
        "New route /history",
        "Add History link to sidebar navigation",
        "Table with Service, Action, Actor, Date, Status columns",
        "Filters: service name search, action type, date range",
        "Sortable by date (newest first default)",
        "Pagination",
        "Restore action with confirmation",
        "Add tests",
        "Verify in browser",
        "Typecheck passes"
      ]
    },
    {
      "id": "US-018",
      "linearTicket": "SRE-117",
      "linearUrl": "https://linear.app/linq/issue/SRE-117",
      "title": "Add undo toast for destructive actions",
      "description": "As a user, I want an Undo option in the success toast after destructive actions.",
      "phase": 5,
      "type": "frontend",
      "scope": "ui",
      "dependencies": ["US-004", "US-015"],
      "acceptanceCriteria": [
        "Destructive action toasts include Undo button",
        "Extended 10 second toast duration for undo",
        "Clicking Undo immediately restores from snapshot",
        "Loading state during restore",
        "Second toast confirms 'Action undone'",
        "Add tests",
        "Verify in browser",
        "Typecheck passes"
      ]
    }
  ],
  "linearTickets": {
    "created": [
      {"id": "SRE-105", "title": "[DB] Add service_snapshots table for backup/restore", "url": "https://linear.app/linq/issue/SRE-105"},
      {"id": "SRE-106", "title": "[API] Add snapshot REST endpoints for backup/restore", "url": "https://linear.app/linq/issue/SRE-106"},
      {"id": "SRE-107", "title": "[UI] Add Dialog component from shadcn", "url": "https://linear.app/linq/issue/SRE-107"},
      {"id": "SRE-108", "title": "[UI] Add Toast notification component from shadcn", "url": "https://linear.app/linq/issue/SRE-108"},
      {"id": "SRE-109", "title": "[UI] Add mutation hooks for service CRUD operations", "url": "https://linear.app/linq/issue/SRE-109"},
      {"id": "SRE-110", "title": "[UI] Add inline toggle switches to Services table", "url": "https://linear.app/linq/issue/SRE-110"},
      {"id": "SRE-111", "title": "[UI] Add inline priority selector to Services table", "url": "https://linear.app/linq/issue/SRE-111"},
      {"id": "SRE-112", "title": "[UI] Add row selection and bulk actions toolbar", "url": "https://linear.app/linq/issue/SRE-112"},
      {"id": "SRE-113", "title": "[UI] Add bulk edit modal for team/priority changes", "url": "https://linear.app/linq/issue/SRE-113"},
      {"id": "SRE-114", "title": "[UI] Add useSnapshots query and restore hooks", "url": "https://linear.app/linq/issue/SRE-114"},
      {"id": "SRE-115", "title": "[UI] Add History tab to ServiceDetail page", "url": "https://linear.app/linq/issue/SRE-115"},
      {"id": "SRE-116", "title": "[UI] Add Service History page for all snapshots", "url": "https://linear.app/linq/issue/SRE-116"},
      {"id": "SRE-117", "title": "[UI] Add undo toast for destructive actions", "url": "https://linear.app/linq/issue/SRE-117"},
      {"id": "SRE-118", "title": "[UI] Add row actions dropdown menu to Services table", "url": "https://linear.app/linq/issue/SRE-118"},
      {"id": "SRE-119", "title": "[UI] Add quick action buttons to ServiceDetail page", "url": "https://linear.app/linq/issue/SRE-119"},
      {"id": "SRE-120", "title": "[UI] Add Edit button to ServiceDetail page header", "url": "https://linear.app/linq/issue/SRE-120"}
    ],
    "existing": [
      {"id": "SRE-69", "title": "[UI] US-011: Service edit functionality", "url": "https://linear.app/linq/issue/SRE-69"},
      {"id": "SRE-70", "title": "[UI] US-012: Service registration", "url": "https://linear.app/linq/issue/SRE-70"}
    ]
  },
  "documentationUpdates": [
    "docs/ARCHITECTURE.md - Add service_snapshots table schema",
    "docs/API.md - Add snapshot endpoints documentation",
    "README.md - Update UI features list"
  ],
  "testRequirements": {
    "backend": [
      "tests/unit/test_snapshots.py",
      "tests/integration/test_snapshot_api.py"
    ],
    "frontend": [
      "ui/src/hooks/use-service-mutations.test.ts",
      "ui/src/hooks/use-snapshots.test.ts",
      "Component tests for new UI components"
    ]
  }
}
