# Ralph Progress Log
Started: Tue Feb  3 13:50:31 CST 2026

## Codebase Patterns
- Database: PostgreSQL with raw SQL (no ORM, no migration framework like Alembic)
- Tables are in the `medic` schema
- Migrations stored in `/migrations/` directory as numbered SQL files (014 is latest)
- All queries use parameterized queries with `%s` placeholders
- Python type checking via mypy (existing codebase has pre-existing type errors in heartbeat.py, medic.py, pagerduty_client.py)
- Unit tests in tests/unit/, run with `python3 -m pytest tests/unit/ -v`
- Pre-existing test failures in test_monitor.py due to missing `slack_client` module (not related to new code)
---

## 2026-02-03 14:15 CST - US-035
- What was implemented:
  - Created approval_requests table migration (migrations/014_create_approval_requests.sql)
  - Columns: request_id (PK), execution_id (FK unique), requested_at, expires_at, status, decided_by, decided_at
  - Status values: pending, approved, rejected, expired
  - CHECK constraint ensures decided_by/decided_at set appropriately per status
  - Indexes: execution_id, status, pending requests, expires_at, decided_by, decided_at
- Files changed:
  - migrations/014_create_approval_requests.sql (new)
- **Learnings for future iterations:**
  - Migration file numbering: check existing migrations to find next number (was 014)
  - Follow existing pattern for table/column comments
  - CHECK constraints can enforce business logic (e.g., decided_by must be set when status is approved/rejected)
  - Unique constraint on execution_id ensures one approval request per execution
---
